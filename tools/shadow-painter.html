<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wind Shadow Shape Painter</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #1a1a2e;
      color: #eee;
      margin: 0;
      padding: 20px;
      min-height: 100vh;
    }
    h1 { margin: 0 0 10px; color: #6aaeff; }
    .subtitle { color: #888; margin-bottom: 20px; }
    .container {
      display: flex;
      gap: 30px;
      flex-wrap: wrap;
    }
    .left-panel {
      flex: 1;
      min-width: 400px;
    }
    .right-panel {
      flex: 1;
      min-width: 300px;
    }
    .grid-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      background: #16213e;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    .grid-label {
      font-size: 12px;
      color: #6aaeff;
      margin-bottom: 10px;
    }
    .grid {
      display: grid;
      gap: 1px;
      background: #333;
      padding: 1px;
      border-radius: 4px;
    }
    .cell {
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 9px;
      cursor: pointer;
      transition: all 0.1s;
      user-select: none;
      border-radius: 2px;
    }
    .cell:hover {
      outline: 2px solid #6aaeff;
      z-index: 1;
    }
    .center-col {
      border-left: 2px solid #6aaeff;
      border-right: 2px solid #6aaeff;
    }
    .boat-row {
      border-top: 2px solid #ff6b6b;
    }
    .controls {
      background: #16213e;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    .control-group {
      margin-bottom: 15px;
    }
    .control-group label {
      display: block;
      margin-bottom: 5px;
      color: #888;
    }
    input[type="range"] {
      width: 100%;
    }
    input[type="number"] {
      width: 60px;
      padding: 5px;
      background: #0f0f23;
      border: 1px solid #333;
      color: #fff;
      border-radius: 4px;
    }
    button {
      background: #6aaeff;
      color: #000;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 600;
      margin-right: 10px;
      margin-bottom: 10px;
    }
    button:hover { background: #8bc4ff; }
    button.secondary {
      background: #444;
      color: #fff;
    }
    button.secondary:hover { background: #555; }
    .output {
      background: #0f0f23;
      padding: 15px;
      border-radius: 8px;
      font-family: 'Monaco', 'Menlo', monospace;
      font-size: 11px;
      white-space: pre;
      overflow-x: auto;
      max-height: 400px;
      overflow-y: auto;
      border: 1px solid #333;
    }
    .instructions {
      background: #16213e;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-size: 13px;
      line-height: 1.6;
    }
    .instructions h3 { margin: 0 0 10px; color: #6aaeff; }
    .instructions ul { margin: 0; padding-left: 20px; }
    .instructions code {
      background: #0f0f23;
      padding: 2px 6px;
      border-radius: 3px;
    }
    .legend {
      display: flex;
      gap: 20px;
      margin-top: 10px;
      font-size: 12px;
    }
    .legend-item {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .legend-box {
      width: 20px;
      height: 20px;
      border-radius: 3px;
    }
    .copied-toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #4caf50;
      color: white;
      padding: 15px 25px;
      border-radius: 8px;
      opacity: 0;
      transition: opacity 0.3s;
      font-weight: 600;
    }
    .copied-toast.show { opacity: 1; }
  </style>
</head>
<body>
  <h1>Wind Shadow Shape Painter</h1>
  <p class="subtitle">Paint the shadow shape, then copy to clipboard</p>

  <div class="container">
    <div class="left-panel">
      <div class="instructions">
        <h3>How to use</h3>
        <ul>
          <li><strong>Click + drag</strong> to paint with current brush value</li>
          <li><strong>Right-click</strong> to erase (set to 0)</li>
          <li><strong>Mouse wheel</strong> to adjust brush value</li>
          <li>Row 0 = at boat (top), higher rows = further downwind</li>
          <li>Center column (blue border) = directly behind boat</li>
        </ul>
      </div>

      <div class="grid-container">
        <div class="grid-label">‚Üë BOAT IS HERE (Row 0) ‚Üë</div>
        <div style="display: flex; align-items: center; gap: 10px;">
          <div class="grid-label" style="writing-mode: vertical-rl; text-orientation: mixed; transform: rotate(180deg);">‚Üê WINDWARD</div>
          <div class="grid" id="grid"></div>
          <div class="grid-label" style="writing-mode: vertical-rl; text-orientation: mixed;">LEEWARD ‚Üí</div>
        </div>
        <div class="grid-label">‚Üì DOWNWIND ‚Üì</div>
        <div class="legend">
          <div class="legend-item">
            <div class="legend-box" style="background: #1a1a2e;"></div>
            <span>0 (no shadow)</span>
          </div>
          <div class="legend-item">
            <div class="legend-box" style="background: #6aaeff;"></div>
            <span>50 (medium)</span>
          </div>
          <div class="legend-item">
            <div class="legend-box" style="background: #ff4444;"></div>
            <span>100 (max)</span>
          </div>
        </div>
      </div>
    </div>

    <div class="right-panel">
      <div class="controls">
        <div class="control-group">
          <label>Brush Value:</label>
          <input type="number" id="brushValue" min="0" max="100" value="50" step="5" style="width: 80px;">
        </div>
        <div class="control-group">
          <label>Grid Size</label>
          Rows: <input type="number" id="rows" value="26" min="5" max="50">
          Cols: <input type="number" id="cols" value="11" min="3" max="21" step="2">
          <button class="secondary" onclick="resizeGrid()">Resize</button>
        </div>
        <div style="margin-top: 20px;">
          <button onclick="copyToClipboard()">üìã Copy TypeScript Array</button>
          <button onclick="copyCSV()">üìã Copy CSV</button>
          <button class="secondary" onclick="clearGrid()">Clear</button>
          <button class="secondary" onclick="fillSymmetric()">Mirror Left‚ÜíRight</button>
        </div>
        <div style="margin-top: 10px;">
          <button class="secondary" onclick="loadPreset('narrow')">Preset: Narrow</button>
          <button class="secondary" onclick="loadPreset('wide')">Preset: Wide</button>
          <button class="secondary" onclick="loadPreset('current')">Load Current</button>
        </div>
        
        <div class="control-group" style="margin-top: 15px;">
          <label>Paste Template (TypeScript array, CSV, or just numbers):</label>
          <textarea id="pasteInput" rows="6" style="width: 100%; background: #0f0f23; border: 1px solid #333; color: #fff; border-radius: 4px; padding: 8px; font-family: monospace; font-size: 11px;" placeholder="Paste array or CSV here, e.g.:
0,10,50,80,50,10,0
0,20,60,90,60,20,0
..."></textarea>
          <div style="margin-top: 5px;">
            <button class="secondary" onclick="loadFromPaste()">Load TypeScript</button>
            <button class="secondary" onclick="loadFromCSV()">Load CSV</button>
          </div>
        </div>
      </div>

      <h3 style="margin-bottom: 10px;">Output</h3>
      <div class="output" id="output">// Paint the grid, then click "Copy TypeScript Array"</div>
    </div>
  </div>

  <div class="copied-toast" id="toast">Copied to clipboard!</div>

  <script>
    let gridData = [];
    let rows = 26;
    let cols = 11;
    let brushValue = 50;
    let isMouseDown = false;
    let isRightClick = false;

    // Current template from shadowShape.ts
    const CURRENT_TEMPLATE = [
      [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
      [ 60, 60, 60, 60, 60, 60, 60, 60, 32, 50, 97, 64, 32,  0,  0,  0,  0,  0,  0,  0,  0],
      [ 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 94, 62, 31,  0,  0,  0,  0,  0,  0,  0,  0],
      [ 60, 60, 60, 60, 60, 60, 60, 60, 45, 68, 91, 68, 45, 22,  0,  0,  0,  0,  0,  0,  0],
      [ 60, 60, 60, 60, 60, 60, 60, 60, 44, 66, 88, 66, 44, 22,  0,  0,  0,  0,  0,  0,  0],
      [ 60, 60, 60, 60, 60, 60, 60, 60, 42, 63, 85, 63, 42, 21,  0,  0,  0,  0,  0,  0,  0],
      [ 60, 60, 60, 60, 60, 60, 60, 60, 49, 65, 82, 65, 49, 32, 16,  0,  0,  0,  0,  0,  0],
      [ 60, 60, 60, 60, 60, 60, 60, 60, 47, 63, 79, 63, 47, 31, 15,  0,  0,  0,  0,  0,  0],
      [ 60, 60, 60, 60, 60, 60, 60, 60, 45, 60, 76, 60, 45, 30, 15,  0,  0,  0,  0,  0,  0],
      [ 60, 60, 60, 60, 60, 60, 60, 60, 48, 60, 73, 60, 48, 36, 24, 12,  0,  0,  0,  0,  0],
      [ 60, 60, 60, 60, 60, 60, 60, 60, 46, 58, 70, 58, 46, 35, 23, 11,  0,  0,  0,  0,  0],
      [ 60, 60, 60, 60, 60, 60, 60, 60, 44, 55, 67, 55, 44, 33, 22, 11,  0,  0,  0,  0,  0],
      [ 60, 60, 60, 60, 60, 60, 60, 60, 60, 54, 64, 54, 45, 36, 27, 18,  9,  0,  0,  0,  0],
      [ 60, 60, 60, 60, 60, 60, 60, 60, 43, 52, 61, 52, 43, 34, 26, 17,  8,  0,  0,  0,  0],
      [ 60, 60, 60, 60, 60, 60, 60, 33, 41, 49, 58, 49, 41, 33, 24, 16,  8,  0,  0,  0,  0],
      [ 60, 60, 60, 60, 60, 60, 27, 34, 41, 48, 55, 48, 41, 34, 27, 20, 13,  6,  0,  0,  0],
      [ 60, 60, 60, 60, 13, 19, 26, 32, 39, 45, 52, 45, 39, 32, 26, 19, 13,  6,  0,  0,  0],
      [ 60, 60, 60, 25, 12, 18, 24, 30, 36, 42, 49, 42, 36, 30, 24, 18, 12,  6,  0,  0,  0],
      [ 60, 60,  5, 10, 15, 20, 25, 30, 35, 40, 46, 40, 35, 30, 25, 20, 15, 10,  5,  0,  0],
      [  0,  0,  4,  9, 14, 19, 23, 28, 33, 38, 43, 38, 33, 28, 23, 19, 14,  9,  4,  0,  0],
      [  0,  0,  4,  8, 13, 17, 22, 26, 31, 35, 40, 35, 31, 26, 22, 17, 13,  8,  4,  0,  0],
      [  0,  3,  7, 11, 14, 18, 22, 25, 29, 33, 37, 33, 29, 25, 22, 18, 14, 11,  7,  3,  0],
      [  0,  3,  6, 10, 13, 17, 20, 23, 27, 30, 34, 30, 27, 23, 20, 17, 13, 10,  6,  3,  0],
      [  0,  3,  6,  9, 12, 15, 18, 21, 24, 27, 31, 27, 24, 21, 18, 15, 12,  9,  6,  3,  0],
      [  0,  0,  7, 10, 12, 15, 17, 20, 22, 25, 28, 25, 22, 20, 17, 15, 12, 10,  7,  5,  2],
      [  0,  0,  6,  9, 11, 13, 15, 18, 20, 22, 25, 22, 20, 18, 15, 13, 11,  9,  6,  4,  2],
      [  0,  0,  0, 25, 12, 18, 24, 30, 36, 25, 25, 25, 36, 25, 25, 25, 25, 25, 25, 25, 25],
      [  0,  0,  0,  0,  0,  0, 25, 30, 35, 25, 25, 25, 25, 25,  0,  0,  0,  0,  0,  0,  0],
      [  0,  0,  0,  0,  0,  0, 23,  0, 33, 38,  0,  0,  0,  0, 23, 19, 14,  9,  4,  0,  0],
      [  0,  0,  4,  8, 13, 17, 22, 26, 31, 35, 40, 35, 31, 26, 22, 17, 13,  8,  4,  0,  0],
      [  0,  3,  7, 11, 14, 18, 22, 25, 29, 33, 37, 33, 29, 25, 22, 18, 14, 11,  7,  3,  0],
      [  0,  3,  6, 10, 13, 17, 20, 23, 27, 30, 34, 30, 27, 23, 20, 17, 13, 10,  6,  3,  0],
      [  0,  3,  6,  9, 12, 15, 18, 21, 24, 27, 31, 27, 24, 21, 18, 15, 12,  9,  6,  3,  0],
      [  2,  5,  7, 10, 12, 15, 17, 20, 22, 25, 28, 25, 22, 20, 17, 15, 12, 10,  7,  5,  2],
      [  2,  4,  6,  9, 11, 13, 15, 18, 20, 22, 25, 22, 20, 18, 15, 13, 11,  9,  6,  4,  2],
    ];

    function initGrid() {
      gridData = [];
      for (let r = 0; r < rows; r++) {
        gridData[r] = [];
        for (let c = 0; c < cols; c++) {
          gridData[r][c] = 0;
        }
      }
      renderGrid();
    }

    function renderGrid() {
      const container = document.getElementById('grid');
      container.innerHTML = '';
      container.style.gridTemplateColumns = `repeat(${cols}, 28px)`;

      const centerCol = Math.floor(cols / 2);

      for (let r = 0; r < rows; r++) {
        for (let c = 0; c < cols; c++) {
          const cell = document.createElement('div');
          cell.className = 'cell';
          if (c === centerCol) cell.classList.add('center-col');
          if (r === 0) cell.classList.add('boat-row');
          cell.dataset.row = r;
          cell.dataset.col = c;
          cell.textContent = gridData[r][c];
          cell.style.background = getCellColor(gridData[r][c]);
          cell.style.color = gridData[r][c] > 50 ? '#000' : '#fff';
          
          cell.addEventListener('mousedown', (e) => {
            e.preventDefault();
            isMouseDown = true;
            isRightClick = e.button === 2;
            paintCell(r, c);
          });
          cell.addEventListener('mouseenter', () => {
            if (isMouseDown) paintCell(r, c);
          });
          cell.addEventListener('contextmenu', (e) => e.preventDefault());
          
          container.appendChild(cell);
        }
      }

      updateOutput();
    }

    function getCellColor(value) {
      if (value === 0) return '#1a1a2e';
      // Blue (low) to Red (high)
      const t = value / 100;
      const r = Math.floor(t * 255);
      const g = Math.floor((1 - t) * 100);
      const b = Math.floor((1 - t) * 255);
      return `rgb(${r}, ${g}, ${b})`;
    }

    function paintCell(r, c) {
      const val = isRightClick ? 0 : brushValue;
      gridData[r][c] = val;
      renderGrid();
    }

    function resizeGrid() {
      rows = parseInt(document.getElementById('rows').value) || 26;
      cols = parseInt(document.getElementById('cols').value) || 11;
      // Ensure cols is odd for center column
      if (cols % 2 === 0) cols++;
      document.getElementById('cols').value = cols;
      initGrid();
    }

    function clearGrid() {
      initGrid();
    }

    function fillSymmetric() {
      const centerCol = Math.floor(cols / 2);
      for (let r = 0; r < rows; r++) {
        for (let c = 0; c < centerCol; c++) {
          const mirrorCol = cols - 1 - c;
          gridData[r][mirrorCol] = gridData[r][c];
        }
      }
      renderGrid();
    }

    function loadPreset(name) {
      if (name === 'current') {
        rows = CURRENT_TEMPLATE.length;
        cols = CURRENT_TEMPLATE[0].length;
        document.getElementById('rows').value = rows;
        document.getElementById('cols').value = cols;
        gridData = CURRENT_TEMPLATE.map(row => [...row]);
        renderGrid();
        return;
      }

      initGrid();
      const centerCol = Math.floor(cols / 2);
      
      if (name === 'narrow') {
        for (let r = 1; r < rows; r++) {
          const intensity = Math.max(0, 100 - r * 4);
          const width = Math.max(1, Math.floor((rows - r) / 8));
          for (let c = centerCol - width; c <= centerCol + width; c++) {
            if (c >= 0 && c < cols) {
              const dist = Math.abs(c - centerCol);
              gridData[r][c] = Math.floor(intensity * (1 - dist / (width + 1)));
            }
          }
        }
      } else if (name === 'wide') {
        for (let r = 1; r < rows; r++) {
          const intensity = Math.max(0, 100 - r * 3);
          const width = Math.min(centerCol, Math.floor(2 + r / 3));
          for (let c = centerCol - width; c <= centerCol + width; c++) {
            if (c >= 0 && c < cols) {
              const dist = Math.abs(c - centerCol);
              gridData[r][c] = Math.floor(intensity * (1 - dist / (width + 1)));
            }
          }
        }
      }
      renderGrid();
    }

    function loadFromPaste() {
      const input = document.getElementById('pasteInput').value;
      if (!input.trim()) {
        alert('Please paste a template first');
        return;
      }

      try {
        // Try to parse the input - handle various formats
        let parsed;
        
        // First, try to extract just the array part if it's a full export statement
        let arrayStr = input;
        const exportMatch = input.match(/=\s*(\[[\s\S]*\])/);
        if (exportMatch) {
          arrayStr = exportMatch[1];
        }
        
        // Clean up the string - remove comments
        arrayStr = arrayStr.replace(/\/\/[^\n]*/g, '');
        
        // Try to parse as JSON (replacing trailing commas)
        arrayStr = arrayStr.replace(/,(\s*[\]\)])/g, '$1');
        
        try {
          parsed = JSON.parse(arrayStr);
        } catch {
          // If JSON fails, try eval (for JS array syntax)
          parsed = eval(arrayStr);
        }

        if (!Array.isArray(parsed) || !Array.isArray(parsed[0])) {
          throw new Error('Not a 2D array');
        }

        // Load the parsed data
        rows = parsed.length;
        cols = parsed[0].length;
        document.getElementById('rows').value = rows;
        document.getElementById('cols').value = cols;
        gridData = parsed.map(row => row.map(v => Math.max(0, Math.min(100, parseInt(v) || 0))));
        renderGrid();
        
        // Show success
        const toast = document.getElementById('toast');
        toast.textContent = 'Template loaded!';
        toast.classList.add('show');
        setTimeout(() => {
          toast.classList.remove('show');
          toast.textContent = 'Copied to clipboard!';
        }, 1500);
        
      } catch (e) {
        alert('Failed to parse template: ' + e.message + '\n\nMake sure it\'s a valid 2D array like:\n[[0, 10, 20],\n [5, 15, 25]]');
      }
    }

    function updateOutput() {
      const lines = ['export const SHADOW_SHAPE_TEMPLATE: number[][] = ['];
      for (let r = 0; r < rows; r++) {
        const rowStr = gridData[r].map(v => v.toString().padStart(3)).join(',');
        const comment = r === 0 ? '  // at boat' : r < 6 ? '  // close' : r < 11 ? '  // mid' : r < 16 ? '  // far' : '  // fading';
        lines.push(`  [${rowStr}],${comment}`);
      }
      lines.push(']');
      document.getElementById('output').textContent = lines.join('\n');
    }

    function copyToClipboard() {
      const text = document.getElementById('output').textContent;
      navigator.clipboard.writeText(text).then(() => {
        const toast = document.getElementById('toast');
        toast.classList.add('show');
        setTimeout(() => toast.classList.remove('show'), 2000);
      });
    }

    function copyCSV() {
      const lines = [];
      for (let r = 0; r < rows; r++) {
        lines.push(gridData[r].join(','));
      }
      const csv = lines.join('\n');
      navigator.clipboard.writeText(csv).then(() => {
        const toast = document.getElementById('toast');
        toast.textContent = 'CSV copied!';
        toast.classList.add('show');
        setTimeout(() => {
          toast.classList.remove('show');
          toast.textContent = 'Copied to clipboard!';
        }, 2000);
      });
    }

    function loadFromCSV() {
      const input = document.getElementById('pasteInput').value;
      if (!input.trim()) {
        alert('Please paste CSV data first');
        return;
      }

      try {
        // Split into lines and parse each as comma-separated values
        const lines = input.trim().split('\n').filter(line => line.trim());
        const parsed = lines.map(line => 
          line.split(',').map(v => Math.max(0, Math.min(100, parseInt(v.trim()) || 0)))
        );

        if (parsed.length === 0 || parsed[0].length === 0) {
          throw new Error('Empty CSV');
        }

        // Load the parsed data
        rows = parsed.length;
        cols = parsed[0].length;
        document.getElementById('rows').value = rows;
        document.getElementById('cols').value = cols;
        gridData = parsed;
        renderGrid();
        
        // Show success
        const toast = document.getElementById('toast');
        toast.textContent = 'CSV loaded!';
        toast.classList.add('show');
        setTimeout(() => {
          toast.classList.remove('show');
          toast.textContent = 'Copied to clipboard!';
        }, 1500);
        
      } catch (e) {
        alert('Failed to parse CSV: ' + e.message + '\n\nMake sure it\'s comma-separated values like:\n0,10,50,80,50,10,0\n0,20,60,90,60,20,0');
      }
    }

    // Event listeners
    document.getElementById('brushValue').addEventListener('input', (e) => {
      brushValue = parseInt(e.target.value) || 0;
    });

    document.addEventListener('mouseup', () => {
      isMouseDown = false;
      isRightClick = false;
    });

    document.addEventListener('wheel', (e) => {
      if (e.target.classList.contains('cell')) {
        e.preventDefault();
        brushValue = Math.max(0, Math.min(100, brushValue + (e.deltaY > 0 ? -5 : 5)));
        document.getElementById('brushValue').value = brushValue;
      }
    }, { passive: false });

    // Initialize
    loadPreset('current');
  </script>
</body>
</html>
